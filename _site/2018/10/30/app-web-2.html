
<h1 id="aplicações-na-web---parte-ii">Aplicações na Web - Parte II</h1>

<p>(Actividade da ExpoFCT 2018)
<a href="https://cienciavivadifct.bitbucket.io/">https://cienciavivadifct.bitbucket.io/</a></p>

<p>Esta atividade é um exemplo da utilização das tecnologias base de implementação
de páginas web (HTML, CSS, e TypeScript) para implementar um “jogo” muito simples,
que consiste na simulação de um conjunto de bolas a serem largadas numa caixa.</p>

<p>Nesta página encontras as instruções de construção deste jogo num conjunto de passos
que te levarão à implementação final.</p>

<h2 id="tutorial">Tutorial</h2>

<p>Bem-vindo ao tutorial de Aplicações Web da ExpoFCT 2018. Neste tutorial vamos olhar
para uma linguagem de programação chamada JavaScript e como usá-la para implementar
um simples demo de bolas saltitantes. Para implementar este “jogo” segue as instruções abaixo:</p>

<h3 id="passo-1-preparação">Passo 1: Preparação</h3>

<p>Abre o ficheiro <a href="index.html"><code class="highlighter-rouge">index.html</code></a> no browser e, de seguida, abre a consola de programador (<code class="highlighter-rouge">Ctrl+Shift+J</code>).
É nesta consola que vamos criar o nosso jogo!</p>

<p>Vês a caixa vazia na página web? Estes é o elemento básico do nosso jogo, o canvas.
É neste canvas que serão desenhados os objetos do jogo.</p>

<h3 id="passo-2-desenhar-uma-bola">Passo 2: Desenhar uma bola</h3>

<p>Vamos começar por desenhar uma bola no meio do canvas. Para desenhar a bola precisamos de indicar qual a sua cor (<code class="highlighter-rouge">rgb(0, 153, 51)</code>), raio (<code class="highlighter-rouge">10</code>), e posição no canvas (<code class="highlighter-rouge">(x=500, y=300)</code>). Para tal copia o código abaixo:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"pool"</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">'2d'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="s2">"rgb(0,153,51)"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">radius</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">draw</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">);</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Para desenhar a bola basta escreveres na consola do browser <code class="highlighter-rouge">draw(x, y, color, radius)</code>.</p>

<p>Podes experimentar desenhar bolas noutros locais do canvas, alterando o valor de <code class="highlighter-rouge">x</code> ou <code class="highlighter-rouge">y</code>; dar outra cor à bola, alterando a variável <code class="highlighter-rouge">color</code> (podes escolher a tua cor preferida <a href="https://www.w3schools.com/colors/colors_picker.asp">aqui</a>); mudar o tamanho da bola alterando o valor de <code class="highlighter-rouge">radius</code>.</p>

<h3 id="passo-3-física">Passo 3: Física!</h3>

<p>Um jogo com uma bola sem fazer nada é um pouco aborrecido! Neste passo vamos acrescentar movimento à bola atraves de deslocamento horizontal (<code class="highlighter-rouge">dx</code>) e vertical (<code class="highlighter-rouge">dy</code>). Definir o movimento da bola é, no fundo, atualizar a sua posição (<code class="highlighter-rouge">x</code>, <code class="highlighter-rouge">y</code>) de frame em frame. Para tal, precisamos de criar uma função (<code class="highlighter-rouge">update</code>) que define este comportamento, ou seja, que atualiza as coordenadas da bola dado um deslocamento em x (<code class="highlighter-rouge">dx</code>) e em y (<code class="highlighter-rouge">dy</code>).</p>

<p>Por último, para completar a animação precisamos de, em cada frame, limpar o canvas, atualizar a posição da bola (chamando a função <code class="highlighter-rouge">update</code>), e voltar a desenhá-la no ecrã. Para isto vamos usar a função <code class="highlighter-rouge">gameLoop</code>.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">dx</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">dy</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">update</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">;</span>
    <span class="nx">y</span> <span class="o">+=</span> <span class="nx">dy</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">gameLoop</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">"rgb(255,255,255)"</span><span class="p">;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="nx">update</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">);</span>
    <span class="nx">draw</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">color</span><span class="p">,</span><span class="nx">radius</span><span class="p">);</span>
    <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">gameLoop</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Para ativar a parte de física temos de chamar a função que atualiza o ecrã a cada animação: <code class="highlighter-rouge">gameLoop()</code>.</p>

<h3 id="passo-4-saltar-nas-paredes-do-canvas">Passo 4: Saltar nas paredes do canvas</h3>

<p>No último passo o nosso pequeno jogo ficou mais interessante ao adicionar movimento
à bola. No entanto, seria bom que a bola ao bater numa extremidade do canvas
saltasse na direção oposta. Para isso, temos de alterar a nossa definição da função <code class="highlighter-rouge">update</code>.
O código em baixo faz exatamente isso: verifica qual a
extremidade em que a bola bateu e inverte o valor do deslocamento para que a
bola se desloque no sentido oposto. Copia o código abaixo.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">update</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">;</span>
    <span class="nx">y</span> <span class="o">+=</span> <span class="nx">dy</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">radius</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">dx</span><span class="p">);</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">dx</span><span class="p">);</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">radius</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">radius</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">dy</span><span class="p">);</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">dy</span><span class="p">);</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nx">radius</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="passo-5-adicionar-gravidade">Passo 5: Adicionar gravidade</h3>

<p>Vamos tornar o nosso jogo ainda mais interessante e realista ao adicionar gravidade.
No nosso jogo a gravidade é simulada como um deslocamento vertical constante (<code class="highlighter-rouge">gravity</code>), que é adicionado ao deslocamento vertical da bola (<code class="highlighter-rouge">dy</code>) a cada frame. O seguinte código adiciona gravidade ao jogo:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">gravity</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">;</span>
<span class="nx">dy</span> <span class="o">+=</span> <span class="nx">gravity</span><span class="p">;</span>
</code></pre></div></div>

<p>Acrescenta-o à definição da função <code class="highlighter-rouge">update</code> ficando assim:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">update</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">;</span>
    <span class="nx">y</span> <span class="o">+=</span> <span class="nx">dy</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">radius</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">dx</span><span class="p">);</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">dx</span><span class="p">);</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">radius</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">radius</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">dy</span><span class="p">);</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">dy</span><span class="p">);</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nx">radius</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">gravity</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">;</span>
    <span class="nx">dy</span> <span class="o">+=</span> <span class="nx">gravity</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="passo-6-agitar">Passo 6: Agitar</h3>

<p>Ok, a gravidade é engraçada, mas ao fim de um tempo a bola fica parada no chão
tornando o nosso jogo um pouco aborrecido. Vamos adicionar a opção de agitar a
bola para que esta fique outra vez a saltar. Repara que esta funcionalidade
está ligada a um botão da interface, permitindo assim uma maior interação entre
o utilizador e o canvas.</p>

<p>Copia o seguinte código para adicionar a funcionalidade de agitar a bola:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">random</span><span class="p">(</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="nx">min</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">num</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">shake</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">dx</span> <span class="o">=</span> <span class="nx">random</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
    <span class="nx">dy</span> <span class="o">=</span> <span class="nx">random</span><span class="p">(</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="passo-7-acrescentar-botões-à-pagina">Passo 7: Acrescentar botões à pagina</h3>

<p>Vamos adicionar algumas funcionalidades à interface do nosso jogo! Vamos acrescentar botões para:</p>

<ul>
  <li>agitar as bolas</li>
  <li>ligar ou desligar a gravidade</li>
  <li>colocar o jogo em pausa</li>
</ul>

<p>Para isso é necessário alterar o código HTML, isto no entanto não é possível fazer
através da consola de programador, é preciso editar directamente o ficheiro.</p>

<p>Faz download do <a href="jumpingballs.zip">zip com os ficheiros do projeto</a>. Depois de extraído o zip,
abre o ficheiro <code class="highlighter-rouge">index.html</code> com um editor de texto e acrescenta os seguintes elementos à div <code class="highlighter-rouge">buttons</code>.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"freezeButton"</span><span class="nt">&gt;</span>Freeze<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"shakeButton"</span><span class="nt">&gt;</span>Shake<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"gravityButton"</span><span class="nt">&gt;</span>Gravity <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"gravity"</span><span class="nt">&gt;</span>ON<span class="nt">&lt;/span&gt;&lt;/button&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"controlbox"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"number"</span><span class="nt">&gt;</span>#balls<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"number"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">size=</span><span class="s">"3"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"setBallsButton"</span><span class="nt">&gt;</span>Set<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>

<p>Abre o ficheiro <code class="highlighter-rouge">index.html</code> no browser e agora na interface devem ser
visíveis botões para controlar as diferente funcionalidades do jogo. Nota que
os botões ainda não fazem nada, no próximo passo vamos ligar os botões ao código
do jogo.</p>

<p>Ainda dentro da pasta do projeto existe um ficheiro com o nome <code class="highlighter-rouge">pool.js</code>. Este
ficheiro tem o código JavaScript com toda a lógica do nosso jogo das bolas saltitonas.</p>

<p>A diferença do nosso código anterior para este novo código é a definição
de uma classe para as bolas. Uma classe vai permitir a criação de vários objetos
com comportamento semelhante, neste caso bolas. A classe inclui os valores iniciais
da posição, deslocamento e ainda a cor da bola. Esta classe permite ainda
definir o comportamento das bolas, por exemplo o que acontece quando uma bola bate
na extremidade do canvas.</p>

<h3 id="passo-8-ligar-os-botões-ao-código-do-jogo">Passo 8: Ligar os botões ao código do jogo</h3>

<p>Vamos tornar o nosso jogo um pouco mais interativo, permitindo que o utilizador
controle certos aspetos da física que o nosso jogo implementa. O código abaixo
liga os botões <code class="highlighter-rouge">freeze</code> e <code class="highlighter-rouge">shake</code> da interface da página web.</p>

<p>Abre o ficheiro <code class="highlighter-rouge">pool.js</code> existente na pasta do projeto e adiciona o seguinte
código:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">freezing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">freezeButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'freezeButton'</span><span class="p">);</span>
<span class="nx">freezeButton</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">freezing</span> <span class="o">=</span> <span class="o">!</span><span class="nx">freezing</span><span class="p">;</span> <span class="p">};</span>

<span class="kd">var</span> <span class="nx">shakeButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'shakeButton'</span><span class="p">);</span>
<span class="nx">shakeButton</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">shake</span><span class="p">()</span> <span class="p">};</span>

<span class="kd">var</span> <span class="nx">gravity</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">gravityButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'gravityButton'</span><span class="p">);</span>
<span class="nx">gravityButton</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">gravity</span> <span class="o">=</span> <span class="o">!</span><span class="nx">gravity</span><span class="p">;</span> <span class="p">};</span>
</code></pre></div></div>

<p>É necessário também actualizar o código da função <code class="highlighter-rouge">update</code> e <code class="highlighter-rouge">gameLoop</code>. Agora com os
botões da interface ligados passa a ser preciso verificar se a gravidade está ligada ou
se o jogo está em pausa antes de executar as operações.</p>

<p>O novo código da gravidade a alterar no final da função <code class="highlighter-rouge">update</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span> <span class="nx">gravity</span> <span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dy</span> <span class="o">+=</span> <span class="nx">GRAVITY</span><span class="p">;</span>
</code></pre></div></div>

<p>Substitui também o código da função <code class="highlighter-rouge">gameLoop</code> pelo seguinte código:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">gameloop</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">freezing</span> <span class="p">)</span>
        <span class="nx">balls</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">update</span><span class="p">();</span>

    <span class="nx">balls</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
    <span class="nx">loopRef</span> <span class="o">=</span> <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">gameloop</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="passo-9-mais-bolas">Passo 9: Mais bolas!</h3>

<p>Vamos agora adicionar mais bolas ao nosso jogo. O ficheiro de JavaScript <code class="highlighter-rouge">pool.js</code>
já está preparado para a adição de mais bolas, existe uma classe <code class="highlighter-rouge">Ball</code>
que vai premitir a criação e desenho de várias bolas no canvas do jogo.</p>

<p>A única coisa a fazer é desenhar realmente as várias bolas no canvas, para tal
é preciso alterar a função <code class="highlighter-rouge">gameLoop</code>, cujo novo código se encontra abaixo.</p>

<p>Substitui então o código da função <code class="highlighter-rouge">gameLoop</code> pelo seguinte código:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">gameloop</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">balls</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">freezing</span> <span class="p">)</span>
            <span class="nx">balls</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">update</span><span class="p">();</span>

        <span class="nx">balls</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">loopRef</span> <span class="o">=</span> <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">gameloop</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="passo-10-colisões">Passo 10: Colisões</h3>

<p>De forma a tornar o nosso jogo mais dinâmico vamos adicionar código que permite
detetar colisões entre bolas. Para cada bola que existe no canvas é preciso
verificar se alguma das restantes bolas colidiu com esta. Uma colisão acontece
quando a área de desenho de duas se sobrepõe, o código abaixo verifica esta situação
e quando isso acontece a velocidade das bolas é alterada para que se desloquem
em sentidos opostos.</p>

<p>Vamos começar por adicionar um botão para ligar/desligar as colisões das bolas,
adiciona o seguinte código ao ficheiro <code class="highlighter-rouge">index.html</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"collisionButton"</span><span class="nt">&gt;</span>Collisions <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"gravity"</span><span class="nt">&gt;</span>ON<span class="nt">&lt;/span&gt;&lt;/button&gt;</span>
</code></pre></div></div>

<p>Copia o código abaixo para o ficheiro <code class="highlighter-rouge">pool.js</code> para tratar das colisões entre bolas:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">colliding</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">collisionButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'collisionButton'</span><span class="p">);</span>
<span class="nx">collisionButton</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">colliding</span> <span class="o">=</span> <span class="o">!</span><span class="nx">colliding</span><span class="p">;</span> <span class="p">};</span>

<span class="kd">function</span> <span class="nx">testCollision</span><span class="p">(</span><span class="nx">b0</span><span class="p">,</span> <span class="nx">b1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">b0</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">b0</span><span class="p">.</span><span class="nx">dx</span> <span class="o">-</span> <span class="nx">b1</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">b1</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">b0</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">b0</span><span class="p">.</span><span class="nx">dx</span> <span class="o">-</span> <span class="nx">b1</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">b1</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">+</span>
        <span class="p">(</span><span class="nx">b0</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">b0</span><span class="p">.</span><span class="nx">dy</span> <span class="o">-</span> <span class="nx">b1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">b1</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">b0</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">b0</span><span class="p">.</span><span class="nx">dy</span> <span class="o">-</span> <span class="nx">b1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">b1</span><span class="p">.</span><span class="nx">dy</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nx">RADIUS</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">collideX</span><span class="p">(</span><span class="nx">b0</span><span class="p">,</span> <span class="nx">b1</span><span class="p">);</span>
        <span class="nx">collideY</span><span class="p">(</span><span class="nx">b0</span><span class="p">,</span> <span class="nx">b1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">collideX</span><span class="p">(</span><span class="nx">ball0</span><span class="p">,</span> <span class="nx">ball1</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">dxAvg</span> <span class="o">=</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">==</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span><span class="p">))</span> <span class="p">{</span> <span class="c1">//both in the same direction, one continues the other bounces back</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dxAvg</span><span class="p">;</span>
            <span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dxAvg</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dxAvg</span><span class="p">;</span>
            <span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dxAvg</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="c1">//frontal collision, both bounce back</span>
        <span class="kd">var</span> <span class="nx">dxAvg</span> <span class="o">=</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dxAvg</span><span class="p">;</span>
            <span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dxAvg</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dxAvg</span><span class="p">;</span>
            <span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dxAvg</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dxAvg</span><span class="p">;</span>
            <span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dxAvg</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">middleX</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">ball1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">middleX</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ball0</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">middleX</span> <span class="o">-</span> <span class="nx">RADIUS</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">ball1</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">middleX</span> <span class="o">+</span> <span class="nx">RADIUS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nx">ball0</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">middleX</span> <span class="o">+</span> <span class="nx">RADIUS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">ball1</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">middleX</span> <span class="o">-</span> <span class="nx">RADIUS</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">collideY</span><span class="p">(</span><span class="nx">ball0</span><span class="p">,</span> <span class="nx">ball1</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">dyAvg</span> <span class="o">=</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">==</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dyAvg</span><span class="p">;</span>
            <span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dyAvg</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dyAvg</span><span class="p">;</span>
            <span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dyAvg</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dyAvg</span><span class="p">;</span>
            <span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dyAvg</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dyAvg</span><span class="p">;</span>
            <span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dyAvg</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball0</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dyAvg</span><span class="p">;</span>
            <span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">ball1</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">dyAvg</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>É preciso ainda actualizar a função <code class="highlighter-rouge">gameLoop</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">gameloop</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">balls</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">freezing</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">balls</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">update</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">colliding</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">balls</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
                    <span class="nx">testCollision</span><span class="p">(</span><span class="nx">balls</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">balls</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="nx">balls</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">loopRef</span> <span class="o">=</span> <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">gameloop</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="recursos-extra">Recursos extra</h2>

<ul>
  <li>
    <p>Um <a href="http://www.typescriptgames.com/HTML5CanvasBasics.html">tutorial</a> sobre como instalar e correr um projeto TypeScript.</p>
  </li>
  <li>
    <p>Um <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Object_building_practice">tutorial da mozilla</a> sobre como utilizar o canvas criando um demo de bolas saltitonas parecido ao nosso.</p>
  </li>
  <li>
    <p>Um exemplo de uma animação mais complexa que simula o movimento de um cardume
de peixes - <a href="http://paal.org/blog/2014/11/06/fishes-flocking-fun-with-javascript/">Fishes flocking fun with JavaScript</a>.</p>
  </li>
</ul>

